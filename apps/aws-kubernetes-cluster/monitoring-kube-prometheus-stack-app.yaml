apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: monitoring-kube-prometheus-stack
    namespace: argocd
spec:
    project: default
    source:
        repoURL: https://prometheus-community.github.io/helm-charts
        chart: kube-prometheus-stack
        targetRevision: 79.8.2 # 최신 버전 (2025 기준)
        helm:
            values: |
                grafana:
                  enabled: true
                prometheus:
                  prometheusSpec:
                    serviceMonitorSelector: {}
                    ruleSelector: {}
                    alerting:
                      alertmanagers:
                        - namespace: monitoring
                          name: kube-prometheus-stack-alertmanager
                          port: web
    destination:
        server: 'https://kubernetes.default.svc'
        namespace: monitoring
    syncPolicy:
        automated:
            prune: true
            selfHeal: true
